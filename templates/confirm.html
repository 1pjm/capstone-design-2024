<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>정보 확인 및 수정</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function enableEdit(id) {
            var button = document.getElementById(id + '_btn');
            var cancel = document.getElementById(id + '_cancel');
            var save = document.getElementById(id + '_save');

            if (id === 'diseases') {
                document.querySelectorAll('[name="disease"]').forEach(e => e.disabled = false);
            }
            button.style.display = 'none';
            cancel.style.display = 'inline-block';
            save.style.display = 'inline-block';
        }

        function cancelEdit(id, originalValues) {
            var button = document.getElementById(id + '_btn');
            var cancel = document.getElementById(id + '_cancel');
            var save = document.getElementById(id + '_save');

            if (id === 'diseases') {
                document.querySelectorAll('[name="disease"]').forEach(e => {
                    e.disabled = true;
                    e.checked = originalValues.includes(e.value); 
                });
            }
            button.style.display = 'inline-block';
            cancel.style.display = 'none';
            save.style.display = 'none';
        }

        function saveEdit(id) {
            var value;

            if (id === 'diseases') {
                value = Array.from(document.querySelectorAll('[name="disease"]:checked')).map(e => e.value);
            }

            var form = document.getElementById('editForm');
            var hiddenField = document.createElement('input');
            hiddenField.type = 'hidden';
            hiddenField.name = 'edit';
            hiddenField.value = id;

            var valueField = document.createElement('input');
            valueField.type = 'hidden';
            valueField.name = 'value';
            valueField.value = JSON.stringify(value);

            form.appendChild(hiddenField);
            form.appendChild(valueField);

            form.submit();
        }
    </script>
</head>
<body>
    <h1>정보 확인 및 수정</h1>
    <form id="editForm" method="POST" action="{{ url_for('confirm') }}">
        <label for="gender">성별:</label>
        <select id="gender" name="gender" disabled>
            <option value="남자" {% if data['gender'] == '남자' %}selected{% endif %}>남자</option>
            <option value="여자" {% if data['gender'] == '여자' %}selected{% endif %}>여자</option>
        </select>
        <br>

        <label for="age">나이:</label>
        <input type="text" id="age" name="age" value="{{ data['age'] }}" readonly>
        <br>

        <label for="height">키 (cm):</label>
        <input type="text" id="height" name="height" value="{{ data['height'] }}" readonly>
        <br>

        <label for="weight">몸무게 (kg):</label>
        <input type="text" id="weight" name="weight" value="{{ data['weight'] }}" readonly>
        <br>

        <label for="pa_level">활동 수준:</label>
        <select id="pa_level" name="pa_level" disabled>
            <option value="1" {% if data['pa_level'] == "1" %}selected{% endif %}>1: 비활동적</option>
            <option value="2" {% if data['pa_level'] == "2" %}selected{% endif %}>2: 저활동적</option>
            <option value="3" {% if data['pa_level'] == "3" %}selected{% endif %}>3: 활동적</option>
            <option value="4" {% if data['pa_level'] == "4" %}selected{% endif %}>4: 매우 활동적</option>
        </select>
        <br>

        <label for="diseases">질병 유무:</label><br>
        <input type="checkbox" id="고혈압" name="disease" value="고혈압" {% if data['diseases']['고혈압'] %}checked{% endif %} disabled> 고혈압<br>
        <input type="checkbox" id="당뇨병" name="disease" value="당뇨병" {% if data['diseases']['당뇨병'] %}checked{% endif %} disabled> 당뇨병<br>
        <input type="checkbox" id="위암" name="disease" value="위암" {% if data['diseases']['위암'] %}checked{% endif %} disabled> 위암<br>
        <input type="checkbox" id="대장암" name="disease" value="대장암" {% if data['diseases']['대장암'] %}checked{% endif %} disabled> 대장암<br>
        <input type="checkbox" id="고지혈증" name="disease" value="고지혈증" {% if data['diseases']['고지혈증'] %}checked{% endif %} disabled> 고지혈증<br>
        <input type="checkbox" id="골다공증" name="disease" value="골다공증" {% if data['diseases']['골다공증'] %}checked{% endif %} disabled> 골다공증<br>
        <button type="button" id="diseases_btn" onclick="enableEdit('diseases')">수정</button>
        <button type="button" id="diseases_cancel" onclick="cancelEdit('diseases', ['{% if data["diseases"]["고혈압"] %}고혈압{% endif %}', '{% if data["diseases"]["당뇨병"] %}당뇨병{% endif %}', '{% if data["diseases"]["위암"] %}위암{% endif %}', '{% if data["diseases"]["대장암"] %}대장암{% endif %}', '{% if data["diseases"]["고지혈증"] %}고지혈증{% endif %}', '{% if data["diseases"]["골다공증"] %}골다공증{% endif %}'])" style="display:none;">취소</button>
        <button type="button" id="diseases_save" onclick="saveEdit('diseases')" style="display:none;">완료</button>
        <br>

        <button type="submit" name="confirm">확인</button>
    </form>
</body>
</html>
<!--  -->